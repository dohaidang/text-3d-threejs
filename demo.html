<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Edition</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #020202; 
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        #input_video {
            position: absolute;
            bottom: 20px; 
            right: 20px;
            width: 120px;
            height: auto;
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            z-index: 100;
            transform: scaleX(-1);
            opacity: 0.7;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        #credit {
            position: absolute;
            bottom: 15px;
            right: 20px;
            color: #00ffff;
            font-family: 'Segoe UI', Arial, sans-serif;
            font-weight: bold;
            font-size: 16px;
            z-index: 200;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            pointer-events: none;
            letter-spacing: 1px;
        }

        #loading {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            color: #ffffff; 
            font-family: 'Arial'; 
            font-weight: bold; 
            font-size: 22px;
            text-shadow: 0 0 15px #00ffff; 
            pointer-events: none; 
            text-align: center;
            z-index: 101;
        }

        #hud {
            position: absolute; 
            top: 20px; 
            left: 20px;
            color: #fff; 
            font-family: 'Segoe UI', Roboto, monospace; 
            font-size: 12px; 
            pointer-events: none;
            background: rgba(0, 0, 0, 0.7); 
            padding: 12px 16px; 
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(0,255,255,0.1);
            min-width: 200px;
        }
        
        .hand-status-box {
            margin-bottom: 12px;
        }
        
        .hand-status-box:last-child {
            margin-bottom: 0;
        }
        
        .hand-label {
            color: #00ffcc; 
            font-weight: bold; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            font-size: 11px;
            margin-bottom: 6px;
        }
        
        .hand-status {
            color: #aaaaaa;
            font-size: 13px;
            font-weight: 500;
            padding: 4px 0;
            transition: color 0.3s ease;
        }
        
        .hand-status.active {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .hand-status.neon {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        
        .hand-status.gold {
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.8);
        }
        
        .hand-status.love {
            color: #ff3388;
            text-shadow: 0 0 10px rgba(255, 51, 136, 0.8);
        }
        
        .hand-status.fist {
            color: #ff0066;
            text-shadow: 0 0 10px rgba(255, 0, 102, 0.8);
        }
        
        .hand-status.open {
            color: #00ff66;
            text-shadow: 0 0 10px rgba(0, 255, 102, 0.8);
        }
        
        .hand-status.flow {
            color: #66ccff;
            text-shadow: 0 0 10px rgba(102, 204, 255, 0.8);
        }

        #performance {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
            z-index: 150;
            pointer-events: none;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>

    <!-- Three.js and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    
    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>
<body>

<div id="loading">‚ú® ƒêang kh·ªüi ƒë·ªông h·ªá th·ªëng...<br>Vui l√≤ng c·∫•p quy·ªÅn Camera.</div>

<div id="hud">
    <div class="hand-status-box">
        <div class="hand-label">üëã Tay Tr√°i</div>
        <div id="left-hand-status" class="hand-status">ƒêang ch·ªù...</div>
    </div>
    <div class="hand-status-box">
        <div class="hand-label">‚úä Tay Ph·∫£i</div>
        <div id="right-hand-status" class="hand-status">ƒêang ch·ªù...</div>
    </div>
</div>

<div id="performance" style="display: none;">
    <div>FPS: <span id="fps">0</span></div>
    <div>Frame Time: <span id="frameTime">0</span>ms</div>
</div>

<video id="input_video"></video>

<script type="module">
    // Import modules
    import { App } from './src/core/App.js';

    // Initialize application
    const app = new App();
    
    // Performance display (optional, press P to toggle)
    let showPerformance = false;
    document.addEventListener('keydown', (e) => {
        if (e.key === 'p' || e.key === 'P') {
            showPerformance = !showPerformance;
            document.getElementById('performance').style.display = showPerformance ? 'block' : 'none';
        }
    });

    // Update performance stats
    setInterval(() => {
        if (showPerformance) {
            const stats = app.getPerformanceStats();
            document.getElementById('fps').textContent = stats.fps;
            document.getElementById('frameTime').textContent = stats.avgFrameTime.toFixed(2);
        }
    }, 1000);

    // Update hand status display
    function updateHandStatus() {
        const state = app.getInteractionState();
        if (!state) return;

        // Update left hand status
        const leftHandEl = document.getElementById('left-hand-status');
        if (state.mode === 1) {
            leftHandEl.textContent = '1 ng√≥n: Hello';
            leftHandEl.className = 'hand-status active neon';
        } else if (state.mode === 2) {
            leftHandEl.textContent = '2 ng√≥n: HaiDang';
            leftHandEl.className = 'hand-status active gold';
        } else if (state.mode === 3) {
            leftHandEl.textContent = '3 ng√≥n: I Love You';
            leftHandEl.className = 'hand-status active love';
        } else {
            leftHandEl.textContent = 'ƒêang ch·ªù...';
            leftHandEl.className = 'hand-status';
        }

        // Update right hand status
        const rightHandEl = document.getElementById('right-hand-status');
        if (state.rightHandAction === 'fist') {
            rightHandEl.textContent = 'N·∫Øm ƒë·∫•m: H·ªë ƒëen';
            rightHandEl.className = 'hand-status active fist';
        } else if (state.rightHandAction === 'open') {
            rightHandEl.textContent = 'X√≤e tay: V·ª• n·ªï';
            rightHandEl.className = 'hand-status active open';
        } else if (state.rightHandAction === 'neutral' && state.rightHandPos.x !== 9999) {
            rightHandEl.textContent = 'L∆∞·ªõt qua: D√≤ng ch·∫£y';
            rightHandEl.className = 'hand-status active flow';
        } else {
            rightHandEl.textContent = 'ƒêang ch·ªù...';
            rightHandEl.className = 'hand-status';
        }
    }

    // Update hand status every 100ms for smooth updates
    setInterval(updateHandStatus, 100);

    // Initialize app
    app.init().then(success => {
        if (!success) {
            console.error('Failed to initialize application');
        }
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
        app.dispose();
    });
</script>
</body>
</html>
